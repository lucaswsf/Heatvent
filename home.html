<!DOCTYPE html>
<html lang='fr'>

	<head>

		<meta charset=utf-8 />
		<title>Heatvent</title>

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<link rel="stylesheet" href="css/normalize.css"/>
		<link rel="stylesheet" href="css/style.css"/>
		<link href="https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.css" rel="stylesheet" />
		<script src="https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.js"></script>


	</head>

	<body>

		<div id="map">
		<div id='map-ui'>
		  <ul id='filters'>
		  </ul>
		</div>
		<div id="info">

			<script>

			// Create a map in the div #map
			var map = L.mapbox.map('map', 'lucaswsf.hma930di');
			map.zoomControl.setPosition('topright');

			// As with any other AJAX request, this technique is subject to the Same Origin Policy:
			// http://en.wikipedia.org/wiki/Same_origin_policy
			// So the CSV file must be on the same domain as the Javascript, or the server
			// delivering it should support CORS.
			var featureLayer = L.mapbox.featureLayer()
			    .loadURL('https://a.tiles.mapbox.com/v3/lucaswsf.hma930di/markers.geojson')
			    .addTo(map);

			var geoJson = [
			    {
			        "type": "Feature",
			        "geometry": {
			            "type": "Point",
			            "coordinates": [2.3871222, 48.8536343]
			        },
			        "properties": {
			            "title": "<p><h1>_WebSchoolFactory</h1></p>",
			            "images": ["img/wsf.jpg"],
			            "description": "<p>208 boulevard Voltaire<br />75011 PARIS<br /><br />Entre école d’ingénieur, école de commerce/gestion et école multimédia <a>LIRE PLUS</a><br /><br />Type d'évènement: Innovation<br />Type de lieu: École<br/><br />Hashtag associé: #RockMyJPO</p>",
			            "marker-color": "#00a8ff",
			            "filter": "Innovation",
			        }

			    },
			    {
			        "type": "Feature",
			        "geometry": {
			            "type": "Point",
			            "coordinates": [2.371523380279541, 48.88999664542457]
			        },
			        "properties": {
			            "title": "Le Cent Quatre",
			            "description": "<p>5 Rue Curial<br />75019 PARIS<br /><br />Ce lieu de création et de production artistique est un établissement pluri-disciplinaire <a>LIRE PLUS</a><br /><br />Type d'évènement: Start-up<br />Type de lieu: Incubateur<br/><br />Hashtag associé: #FENS</p>",
			            "marker-color": "#00a8ff",
			            "filter": "Start-up"
			        }
			    },
			    {
			        "type": "Feature",
			        "geometry": {
			            "type": "Point",
			            "coordinates": [2.3512000000000057, 48.862592]
			        },
			        "properties": {
			            "title": "Anticafé",
			            "description": "<p>79 Rue Quincampoix<br />75003 PARIS<br /><br />L'AntiCafé est un espace de coworking qui propose de payer au temps et de consommer à volonté<a>LIRE PLUS</a><br /><br />Type d'évènement: Entrepreunariat<br />Type de lieu: Collective<br/><br />Hashtag associé: #Bunkr</p>",
			            "marker-color": "#a9e2ff",
			            "filter": "Entrepreunariat",
			            "opacity": 0.5
			        }
			    },
			    {
			        "type": "Feature",
			        "geometry": {
			            "type": "Point",
			            "coordinates": [2.345989000000003, 48.867968]
			        },
			        "properties": {
			            "title": "Silicon Sentier",
			            "description": "<p>12 passage Montmartre<br />75002 PARIS<br /><br />Silicon Sentier est une association d’entreprises destinée à promouvoir les startups et <a>LIRE PLUS</a><br /><br />Type d'évènement: Start-up<br />Type de lieu: Collective<br/><br />Hashtag associé: #WSFconf</p>",
			            "marker-color": "#a9e2ff",
			            "opacity": 0.5
			        }
			    },
			    {
			        "type": "Feature",
			        "geometry": {
			            "type": "Point",
			            "coordinates": [2.32629, 48.88068]
			        },
			        "properties": {
			            "title": "Backelite",
			            "description": "<p>7 rue de Bucarest<br />75008 PARIS<br /><br />Backelite est une agence spécialisée dans le design, la conception et le développement <a>LIRE PLUS</a><br /><br />Type d'évènement: Design<br />Type de lieu: Entreprise<br/><br />Hashtag associé: #Backelite</p>",
			            "marker-color": "#a9e2ff",
			            "opacity": 0.5
			        }
			    },
			    {
			        "type": "Feature",
			        "geometry": {
			            "type": "Point",
			            "coordinates": [2.3669999999999902, 48.833760001]
			        },
			        "properties": {
			            "title": "Incubateur des Arts et Métiers de Paris",
			            "description": "<p>151 boulevard de l'Hôpital<br />75013 PARIS<br /><br />L'Incubateur des Arts et Métiers de Paris : un dispositif complet d’aide à la création d’entreprise <a>LIRE PLUS</a><br /><br />Type d'évènement: Start-up<br />Type de lieu: Incubateur<br/><br />Hashtag associé: #ENSAM</p>",
			            "marker-color": "#00a8ff"
			        }
			    },
			    {
			        "type": "Feature",
			        "geometry": {
			            "type": "Point",
			            "coordinates": [2.324240000000003, 48.848862]
			        },
			        "properties": {
			            "title": "Localeo",
			            "description": "<p>15 rue de l'Abbé Grégoire<br />75006 PARIS<br /><br />Localeo est un fournisseur d’applications hébergées au service des collectivités territoriales, des associations <a>LIRE PLUS</a><br /><br />Type d'évènement: Tech Digitale<br />Type de lieu: Collective<br/><br />Hashtag associé: #Localeo</p>",
			            "marker-color": "#a9e2ff",
			            "opacity": 0.5
			        }
			    },
			    {
			        "type": "Feature",
			        "geometry": {
			            "type": "Point",
			            "coordinates": [2.3029999999999973, 48.842]
			        },
			        "properties": {
			            "title": "Exiacesi",
			            "description": "<p>297 rue de Vaugirard<br />75015 PARIS<br /><br />EXIA est l'école supérieure d'informatique du CESi : elle forme des informaticiens managers à la pointe des technologies.<br /><br />Type d'évènement: Tech Digitale<br />Type de lieu: École<br/><br />Hashtag associé: #EXIA</p>",
			            "marker-color": "#00a8ff"
			        }
			    },
			    {
			        "type": "Feature",
			        "geometry": {
			            "type": "Point",
			            "coordinates": [2.2949999999999875, 48.85]
			        },
			        "properties": {
			            "title": "Printic",
			            "description": "<p>45 rue Héricart<br />75015 PARIS<br /><br />Printic est une application mobile pour le partage et l'impression de ses photos.<br /><br />Type d'évènement: Démonstration<br />Type de lieu: Marketing<br/><br />Hashtag associé: #Printic</p>",
			            "marker-color": "#a9e2ff",
			            "opacity": 0.5
			        }
			    },
			];

			map.featureLayer.setGeoJSON(geoJson);

			// Listen for individual marker clicks
			map.featureLayer.on('click',function(e) {
			    // Force the popup closed.
			    e.layer.closePopup();

			    var feature = e.layer.feature;
			    var info = '<h2>' + feature.properties.title + '</h2>' +
			               '<p>' + feature.properties.description + '</p>';

			    document.getElementById('info').innerHTML = info;
			});


			// Clear the tooltip when map is clicked
			map.on('move',function(e){
			    document.getElementById('info').innerHTML = '<h2>Choisissez un évènement</h2>';
			});



			// find and store a variable reference to the list of filters
			var filters = document.getElementById('filters');

			// Wait until the marker layer is loaded in order to build a list of possible
			// types. If you are doing this with another featureLayer, you should change
			// map.featureLayer to the variable you have assigned to your featureLayer
			map.featureLayer.on('ready', function() {
			  // collect the types of symbols in this layer. you can also just
			  // hardcode an array of types if you know what you want to filter on,
			  // like
			  var types = ['Innovation', 'Entrepreunariat', 'Start-up', 'Design', 'Marketing', 'Technologie numérique'];
			  // var typesObj = {}, types = [];
			  var features = map.featureLayer.getGeoJSON().features;
			  for (var i = 0; i < features.length; i++) {
			    typesObj[features[i].properties['marker-symbol']] = true;
			  }
			  for (var k in typesObj) types.push(k);

			  var checkboxes = [];
			  // create a filter interface
			  for (var i = 0; i < types.length; i++) {
			    // create an <li> list element for each type, and add an input checkbox
			    // and label inside
			    var li = filters.appendChild(document.createElement('li'));
			    var checkbox = li.appendChild(document.createElement('input'));
			    var label = li.appendChild(document.createElement('label'));
			    checkbox.type = 'checkbox';
			    checkbox.id = types[i];
			    checkbox.checked = true;
			    // create a label to the right of the checkbox with explanatory text
			    label.innerHTML = types[i];
			    label.setAttribute('for', types[i]);
			    // whenever a person clicks on this checkbox, call the update() function
			    // below
			    checkbox.addEventListener('change', update);
			    checkboxes.push(checkbox);
			  }

			  // this function is called whenever someone clicks on a checkbox and changes
			  // the selection of markers to be displayed
			  function update() {
			    var enabled = {};
			    // run through each checkbox and record whether it is checked. If it is,
			    // add it to the object of types to display, otherwise do not.
			    for (var i = 0; i < checkboxes.length; i++) {
			      if (checkboxes[i].checked) enabled[checkboxes[i].id] = true;
			    }
			    map.featureLayer.setFilter(function(feature) {
			      // if this symbol is in the list, return true. if not, return false.
			      // the 'in' operator in javascript does exactly that: given a string
			      // or number, it says if that is in a object
			      // 2 in { 2: true } // true
			      // 2 in { } // false
			      return (feature.properties['marker-symbol'] in enabled);
			    });
			  }
			});

			</script>


		</div>
	</body>
</html>
